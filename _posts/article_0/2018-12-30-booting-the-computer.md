---
layout: post
title: BIOS
---


# 计算机启动过程



- BIOS(Basic Input/Output System)**阶段

  ​	BIOS存储在**ROM(Read Only Memory)**上，通电后，计算机首先读取ROM内容。

  ​	BIOS首先执行**POST(Power On Self Test)**，检查各项设备，包括检查RAM大小，检查设备video card, CPU, RAM, keyboard, mouse...

  ​	检查完毕后，可以通过按键F2/F10/delete进入BIOS setup，设定**启动顺序booting order**。默认optical drive最先启动，可以手动设置调整各设备的启动顺序，设备包括optical drive/ hard drive/ CD/ USB drive/ Network等等。

- **主引导记录MBR(Master Boot Record)**阶段

  ​	确定启动顺序之后，控制权转移到最先启动的设备上。MBR总是位于Cylinder 0, Head 0, Sector 1，长度为512个字节，最先被读取。MBR分为三个部分，1-466字节是调用操作系统的机器码，447-510字节是分区表，511-512字节是记录签名（如果是0x55和0xAA，表示该设备可以启动；否则不能。）

  ​	其中，**分区表**共64字节，又分成4个主分区，每个16字节。该16字节分成6个部分。1字节指示激活分区，如果是0x80，表示是激活分区，将拥有控制权；四个分区里只有一个是激活分区。2-4字节指示第一个扇区的物理位置。5字节表明主分区类型。6-8字节是最后一个扇区的物理位置。9-12字节是第一个扇区的逻辑地址。13-16字节是扇区总数。

  ​	计算机读取MBR确定下一步该由哪个分区来进行。

- 硬盘启动阶段

  找到对应的分区之后，进行启动。分为三种情况：

  - **卷引导记录VBR(Volume Boot Record)**：即激活分区的第一个扇区，告诉计算机操作系统的位置。
  - 扩展分区(Extended Partition)和逻辑分区(Logic Partition)：当主分区不够用的时候，其中一个区被定义为**扩展分区**，这个区里面又被分为多个区，这些区叫做**逻辑分区**。从而增加了逻辑上分区的数目。扩展分区的第一个扇区叫做扩展引导记录EBR(Extended Boot Record)。EBR里面的分区表只包含两项，第二项指向下一个逻辑分区，以此类推，形成链状分区索引，直到某个逻辑分区的分区表仅有一项为止。
  - 启动管理器：在这种情况下，计算机读取前446字节后，不寻找分区，二十运行**启动管理器(Boot Loader)**，由用户选择启动哪一个操作系统。

- 操作系统阶段

  找到操作系统的位置后，控制权被交给操作系统。首先操作系统的**内核**/boot/kernel被载入内存，首先运行sbin/init，pid进程号为1。接着init线程加载系统各个模块，最后执行/bin/login等待用户登录。



